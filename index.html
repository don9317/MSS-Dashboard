<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>My Sport Space – Daily Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="page">
    <header>
      <div class="brand">
        <div class="brand-logo">MS</div>
        <div class="brand-title">
          <span>My Sport Space</span>
          <span>Daily Facility Dashboard</span>
        </div>
      </div>

      <div class="filters">
        <span class="filters-label">Date range:</span>
        <button class="filter-btn active" data-range="today">
          <span class="dot"></span> Today
        </button>
        <button class="filter-btn" data-range="yesterday">Yesterday</button>
        <button class="filter-btn" data-range="last_7_days">Last 7 Days</button>
        <button class="filter-btn" data-range="last_30_days">Last 30 Days</button>
        <button class="filter-btn" data-range="this_month">This Month</button>
        <button class="filter-btn" data-range="last_month">Last Month</button>
        <button class="filter-btn" data-range="this_year">This Year</button>
        <button class="filter-btn" id="custom-range-btn" data-range="custom">Custom</button>

        <div class="date-range-inputs" id="custom-range-inputs">
          <input type="date" id="custom-start" />
          <span>–</span>
          <input type="date" id="custom-end" />
        </div>
      </div>
    </header>

    <!-- CSV upload / data control bar -->
    <section class="card upload-card">
      <div class="upload-header">
        <div>
          <div class="card-title">
            Data Source
            <span class="pill-tag green">CSV Testing Mode</span>
          </div>
          <div class="card-subtitle">
            Upload MSS reservation exports (past + current). Files are merged and saved in this browser so you don’t need to re-upload history.
          </div>
        </div>
      </div>
      <div class="upload-body">
        <div class="upload-controls">
          <label class="upload-label">
            <span class="upload-label-main">Upload CSV export</span>
            <span class="upload-label-sub">Headers expected: Name, Area Reserved, Reservation Date, Start Time, End Time, Title, Sport, Paid Status, Price, Form Of Payment</span>
          </label>
          <input type="file" id="csv-input" accept=".csv" />
          <button id="clear-data-btn" class="clear-btn" type="button">Clear saved data</button>
        </div>
        <div class="upload-status">
          <span id="upload-status-text" class="muted">No data loaded yet. Upload one or more CSVs to populate the dashboard.</span>
        </div>
      </div>
    </section>

    <main>
      <!-- Q1: Rentals & Revenue -->
      <section class="card" id="q1-card">
        <div class="card-header">
          <div>
            <div class="card-title">
              Rentals &amp; Revenue
              <span class="pill-tag green">Selected Range</span>
            </div>
            <div class="card-subtitle">
              Snapshot of reservations, revenue, and payment mix.
            </div>
          </div>
        </div>
        <div class="card-body">
          <div class="kpi-row">
            <div class="kpi">
              <div class="kpi-label">Total Rentals</div>
              <div class="kpi-value">
                <span id="total-rentals">0</span>
                <span class="kpi-trend" id="rentals-trend">
                  <span class="arrow">●</span> Waiting for data
                </span>
              </div>
              <div class="kpi-caption">Includes all sports &amp; courts</div>
            </div>
            <div class="kpi">
              <div class="kpi-label">Total Revenue (non-failed)</div>
              <div class="kpi-value">
                <span id="total-revenue">$0.00</span>
                <span class="kpi-trend" id="revenue-trend">
                  <span class="arrow">●</span> Waiting for data
                </span>
              </div>
              <div class="kpi-caption">
                Based on completed / non-failed payments
              </div>
            </div>
          </div>

          <div class="tables-row">
            <div class="table">
              <div class="table-header">
                <span>By Hour</span>
                <span class="muted" id="hourly-label">Selected Range</span>
              </div>
              <div class="table-body">
                <table>
                  <thead>
                    <tr>
                      <th>Hour</th>
                      <th class="text-right">Rentals</th>
                      <th class="text-right">Revenue</th>
                    </tr>
                  </thead>
                  <tbody id="hourly-table-body">
                    <tr>
                      <td colspan="3" class="muted">Upload CSV data to see hourly rentals.</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <div class="table">
              <div class="table-header">
                <span>By Form of Payment</span>
                <span class="muted">Non-failed only</span>
              </div>
              <div class="table-body">
                <table>
                  <thead>
                    <tr>
                      <th>Payment Method</th>
                      <th class="text-right">Rentals</th>
                      <th class="text-right">Revenue</th>
                    </tr>
                  </thead>
                  <tbody id="payment-table-body">
                    <tr>
                      <td colspan="3" class="muted">Upload CSV data to see payment mix.</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <div class="small-note">
            Note: data here is calculated from uploaded MSS reservation exports and stored in your browser only.
          </div>
        </div>
      </section>

      <!-- Q2: Trends -->
      <section class="card" id="q2-card">
        <div class="card-header">
          <div>
            <div class="card-title">
              Trends &amp; Comparisons
              <span class="pill-tag">Analytics</span>
            </div>
            <div class="card-subtitle">
              Current period vs prior, plus YTD vs last YTD (based on uploaded data).
            </div>
          </div>
        </div>
        <div class="card-body">
          <div class="kpi-row">
            <div class="kpi">
              <div class="kpi-label">Current Period Rentals</div>
              <div class="kpi-value">
                <span id="current-rentals">0</span>
                <span class="kpi-trend" id="current-rentals-trend">
                  <span class="arrow">●</span> Waiting for data
                </span>
              </div>
              <div class="kpi-caption">
                Selected date range (e.g., this month to date)
              </div>
            </div>
            <div class="kpi">
              <div class="kpi-label">Current Period Revenue</div>
              <div class="kpi-value">
                <span id="current-revenue">$0.00</span>
                <span class="kpi-trend" id="current-revenue-trend">
                  <span class="arrow">●</span> Waiting for data
                </span>
              </div>
              <div class="kpi-caption">
                Non-failed, all facilities in range
              </div>
            </div>
          </div>

          <div class="tables-row">
            <div class="table">
              <div class="table-header">
                <span>Period vs Prior Period</span>
                <span class="muted">Same length window</span>
              </div>
              <div class="table-body">
                <table>
                  <thead>
                    <tr>
                      <th>Metric</th>
                      <th class="text-right">Current</th>
                      <th class="text-right">Prior</th>
                      <th class="text-right">Δ</th>
                    </tr>
                  </thead>
                  <tbody id="period-compare-body">
                    <tr>
                      <td colspan="4" class="muted">Upload data to see period comparisons.</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <div class="table">
              <div class="table-header">
                <span>YTD vs Last YTD</span>
                <span class="muted">Based on uploaded data</span>
              </div>
              <div class="table-body">
                <table>
                  <thead>
                    <tr>
                      <th>Metric</th>
                      <th class="text-right">YTD</th>
                      <th class="text-right">Last YTD</th>
                      <th class="text-right">Δ</th>
                    </tr>
                  </thead>
                  <tbody id="ytd-compare-body">
                    <tr>
                      <td colspan="4" class="muted">Upload data to see YTD vs last YTD.</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <div class="small-note">
            YTD reflects only dates present in uploaded data until MSS is wired directly to live reservations.
          </div>
        </div>
      </section>

      <!-- Q3: Failed Payments -->
      <section class="card" id="q3-card">
        <div class="card-header">
          <div>
            <div class="card-title">
              Failed Payments
              <span class="pill-tag red">Attention</span>
            </div>
            <div class="card-subtitle">
              Failed in selected range, plus all outstanding failures.
            </div>
          </div>
        </div>
        <div class="card-body">
          <div class="kpi-row">
            <div class="kpi">
              <div class="kpi-label">Failed in Range</div>
              <div class="kpi-value">
                <span id="failed-range-count">0</span>
                <span class="kpi-trend neg" id="failed-range-caption">
                  <span class="arrow">●</span> Waiting for data
                </span>
              </div>
              <div class="kpi-caption">
                Count &amp; total for current date filter
              </div>
            </div>
            <div class="kpi">
              <div class="kpi-label">Outstanding Failed (All Time)</div>
              <div class="kpi-value">
                <span id="failed-outstanding-amount">$0.00</span>
                <span class="kpi-trend neg" id="failed-outstanding-caption">
                  <span class="arrow">●</span> Waiting for data
                </span>
              </div>
              <div class="kpi-caption">
                Remains all-time, regardless of date filter
              </div>
            </div>
          </div>

          <div class="tables-row">
            <div class="table">
              <div class="table-header">
                <span>Failed in Selected Range</span>
                <span class="muted">Customer detail</span>
              </div>
              <div class="table-body">
                <table>
                  <thead>
                    <tr>
                      <th>Date</th>
                      <th>Name</th>
                      <th>Time</th>
                      <th>Area</th>
                      <th class="text-right">Amount</th>
                    </tr>
                  </thead>
                  <tbody id="failed-range-body">
                    <tr>
                      <td colspan="5" class="muted">Upload data to see failed payments for this range.</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <div class="table">
              <div class="table-header">
                <span>Outstanding Failed (All Time)</span>
                <span class="muted">Most recent first</span>
              </div>
              <div class="table-body">
                <table>
                  <thead>
                    <tr>
                      <th>Date</th>
                      <th>Name</th>
                      <th>Time</th>
                      <th>Area</th>
                      <th class="text-right">Amount</th>
                    </tr>
                  </thead>
                  <tbody id="failed-outstanding-body">
                    <tr>
                      <td colspan="5" class="muted">Upload data to see all outstanding failed payments.</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <div class="small-note">
            In production, rows here would link into invoice/payment details (Stripe or MSS billing).
          </div>
        </div>
      </section>

      <!-- Q4: By Sport & Setup Required -->
      <section class="card" id="q4-card">
        <div class="card-header">
          <div>
            <div class="card-title">
              Rentals by Sport &amp; Setup
              <span class="pill-tag green">Operations</span>
            </div>
            <div class="card-subtitle">
              Sport mix for the date range and rentals requiring setup (volleyball, birthday parties).
            </div>
          </div>
        </div>
        <div class="card-body">
          <div class="kpi-row">
            <div class="kpi">
              <div class="kpi-label">Total Sports/Programs</div>
              <div class="kpi-value">
                <span id="sports-count">0</span>
                <span class="kpi-trend">
                  <span class="arrow">●</span> Waiting for data
                </span>
              </div>
              <div class="kpi-caption">
                Distinct sports with at least one rental
              </div>
            </div>
            <div class="kpi">
              <div class="kpi-label">Setup-Required Rentals</div>
              <div class="kpi-value">
                <span id="setup-count">0</span>
                <span class="kpi-trend">
                  <span class="arrow">●</span> Waiting for data
                </span>
              </div>
              <div class="kpi-caption">
                Helpful for staffing &amp; net/party setup
              </div>
            </div>
          </div>

          <div class="tables-row">
            <div class="table">
              <div class="table-header">
                <span>By Sport</span>
                <span class="muted">Selected Range</span>
              </div>
              <div class="table-body">
                <table>
                  <thead>
                    <tr>
                      <th>Sport</th>
                      <th class="text-right">Rentals</th>
                      <th class="text-right">Revenue</th>
                    </tr>
                  </thead>
                  <tbody id="sport-body">
                    <tr>
                      <td colspan="3" class="muted">Upload data to see rentals by sport.</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <div class="table">
              <div class="table-header">
                <span>Setup-Required (Volleyball &amp; Parties)</span>
                <span class="muted">Selected Range</span>
              </div>
              <div class="table-body">
                <table>
                  <thead>
                    <tr>
                      <th>Sport</th>
                      <th class="text-right">Rentals</th>
                      <th class="text-right">Revenue</th>
                    </tr>
                  </thead>
                  <tbody id="setup-body">
                    <tr>
                      <td colspan="3" class="muted">Upload data to see setup-required rentals.</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <div class="small-note">
            Over time, this quadrant can add utilization (courts booked vs capacity) or staffing hints.
          </div>
        </div>
      </section>
    </main>
  </div>

  <script src="app.js"></script>
</body>
</html>
